<!--pages/message/index.wxml-->
<view class="group-chat-container">
  <!-- 顶部搜索和创建 -->
  <view class="header">
    <view class="title-container">
      <view class="page-title-container">
        <view class="title-indicator"></view>
        <text class="title">我的群组</text>
      </view>
      <view class="create-btn" bindtap="openCreateModal">
        <icon class="icon-plus" type="cancel" size="20" color="#9ca3af" />
      </view>
    </view>
    
    <view class="search-container">
      <input 
        class="search-input" 
        placeholder="搜索群组" 
        placeholder-class="search-placeholder"
        value="{{searchText}}"
        bindinput="onSearchInput"
      />
      <icon class="search-icon" type="search" size="14" color="#9ca3af" />
      <view wx:if="{{searchText}}" class="clear-icon" bindtap="clearSearch">
        <icon type="clear" size="14" color="#9ca3af" />
      </view>
    </view>
  </view>
  
  <!-- 群组列表 -->
  <scroll-view 
    scroll-y 
    class="group-list-container"
    enable-flex
    enhanced
    show-scrollbar="{{false}}"
    bounces="{{true}}"
  >
    <!-- 加载中 -->
    <view wx:if="{{loading}}" class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">加载中...</text>
    </view>
    
    <!-- 群组列表 -->
    <block wx:elif="{{filteredGroups.length > 0}}">
      <view 
        wx:for="{{filteredGroups}}" 
        wx:key="ID"
        class="group-item {{item.ID === activeGroupId ? 'active' : ''}}"
        data-id="{{item.ID}}"
        bindtap="selectGroup"
      >
        <!-- 群组头像 -->
        <view class="avatar-container">
          <image 
            wx:if="{{item.AvatarURL}}" 
            src="{{item.AvatarURL}}" 
            class="avatar-image"
            mode="aspectFill"
          ></image>
          <view wx:else class="avatar-placeholder">
            {{item.Name.charAt(0)}}
          </view>
        </view>
        
        <!-- 群组信息 -->
        <view class="group-info">
          <text class="group-name">{{item.Name}}</text>
          <view class="group-meta">
            <view class="member-count">
              <text class="member-icon"></text>
              <text>{{item.MemberCount}}人</text>
            </view>
            <view wx:if="{{item.CreatorID === userInfo.id}}" class="creator-badge">
              <view class="creator-dot"></view>
              <text>创建者</text>
            </view>
          </view>
        </view>
      </view>
    </block>
    
    <!-- 空列表提示 -->
    <view wx:elif="{{!loading}}" class="empty-container">
      <view class="empty-content">
        <view class="empty-icon"></view>
        <text class="empty-text">{{searchText ? '没有找到匹配的群组' : '暂无群组'}}</text>
        <button class="create-group-btn" bindtap="openCreateModal">
          <text class="btn-icon">+</text>
          <text>创建新群组</text>
        </button>
      </view>
    </view>
  </scroll-view>
</view>

<!-- 创建群组模态框 -->
<view class="modal-mask" wx:if="{{createModalVisible}}" bindtap="closeCreateModal"></view>
<view class="modal-container" wx:if="{{createModalVisible}}">
  <view class="modal-header">
    <text class="modal-title">创建新群组</text>
    <view class="modal-close" bindtap="closeCreateModal">×</view>
  </view>
  
  <view class="modal-body">
    <view class="form-item">
      <text class="form-label">群组名称<text class="required">*</text></text>
      <input 
        class="form-input" 
        placeholder="输入群组名称" 
        placeholder-class="search-placeholder"
        value="{{createGroupForm.name}}"
        bindinput="onNameInput"
      />
    </view>
    
    <view class="form-item">
      <text class="form-label">群组描述</text>
      <textarea 
        class="form-textarea" 
        placeholder="输入群组描述" 
        placeholder-class="search-placeholder"
        value="{{createGroupForm.description}}"
        bindinput="onDescriptionInput"
        maxlength="200"
      ></textarea>
    </view>
    
    <view class="form-item">
      <text class="form-label">群组头像链接</text>
      <input 
        class="form-input" 
        placeholder="输入头像URL" 
        placeholder-class="search-placeholder"
        value="{{createGroupForm.avatarUrl}}"
        bindinput="onAvatarUrlInput"
      />
    </view>
  </view>
  
  <view class="modal-footer">
    <button class="btn-cancel" bindtap="closeCreateModal">取消</button>
    <button class="btn-confirm" bindtap="handleCreateGroup">创建</button>
  </view>
</view>