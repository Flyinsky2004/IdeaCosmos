<view class="container" style="padding-top: 0;">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">æ­£åœ¨åŠ è½½ç²¾å½©å†…å®¹...</text>
  </view>

  <block wx:elif="{{project}}">
    <!-- é¡¹ç›®å¤´éƒ¨ä¿¡æ¯ -->
    <view class="project-header" style="margin-top: 0;">
      <view class="cover-container">
        <image class="project-cover" src="{{project.cover_image}}" mode="aspectFill"></image>
        <view class="project-type">{{project.types}}</view>
        <view class="cover-gradient"></view>
      </view>
      
      <view class="header-content">
        <view class="project-title">{{project.project_name}}</view>
        
        <!-- ä½œè€…å’Œç»Ÿè®¡ä¿¡æ¯ -->
        <view class="meta-info">
          <view class="author-info">
            <image class="author-avatar" src="{{project.team.avatar}}" mode="aspectFill"></image>
            <text class="author-name">{{project.team.username}}</text>
          </view>
          <view class="stats-info">
            <view class="stat-item">
              <view class="stat-icon">ğŸ‘ï¸</view>
              <text>{{project.watches}}</text>
            </view>
            <view class="stat-item favorite-item {{isFavorited ? 'favorited' : ''}}" bindtap="toggleFavorite">
              <view class="stat-icon">{{isFavorited ? 'â­' : 'â˜†'}}</view>
              <text>{{project.favorites}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å†…å®¹åŒºåŸŸ -->
    <view class="content-area">
      <!-- é¡¹ç›®æè¿° -->
      <view class="content-section">
        <view class="section-header">
          <text class="section-title" style="color: #F9FAFB;">å‰§æƒ…ç®€ä»‹</text>
        </view>
        <view class="project-desc" style="color: #F3F4F6;">{{project.social_story}}</view>
      </view>

      <!-- åˆ›ä½œé£æ ¼ -->
      <view class="content-section">
        <view class="section-header">
          <text class="section-title" style="color: #F9FAFB;">åˆ›ä½œé£æ ¼</text>
        </view>
        <view class="tags-container">
          <view 
            wx:for="{{project.style}}" 
            wx:key="*this" 
            wx:for-item="tag"
            class="tag"
            style="color: #F3F4F6; background-color: rgba(107, 114, 128, 0.4);"
          >
            {{tag}}
          </view>
        </view>
      </view>

      <!-- é€‚å®œäººç¾¤ -->
      <view class="content-section">
        <view class="section-header">
          <text class="section-title" style="color: #F9FAFB;">é€‚å®œäººç¾¤</text>
        </view>
        <view class="tags-container">
          <view 
            wx:for="{{project.market_people}}" 
            wx:key="*this" 
            class="tag market-tag"
            style="color: #F3F4F6; background-color: rgba(107, 114, 128, 0.4);"
          >
            {{item}}
          </view>
        </view>
      </view>

      <!-- è§’è‰²åˆ—è¡¨ -->
      <view class="content-section" wx:if="{{characters.length > 0}}">
        <view class="section-header">
          <text class="section-title">è§’è‰²åˆ—è¡¨</text>
        </view>
        <scroll-view scroll-x enable-flex class="characters-scroll" show-scrollbar="false">
          <view class="characters-container">
            <view 
              class="character-item" 
              wx:for="{{characters}}" 
              wx:key="ID"
            >
              <image class="character-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
              <view class="character-info">
                <text class="character-name">{{item.name}}</text>
                <text class="character-desc">{{item.description}}</text>
              </view>
            </view>
          </view>
        </scroll-view>
      </view>

      <!-- ç« èŠ‚åˆ—è¡¨ -->
      <view class="content-section">
        <view class="section-header">
          <text class="section-title">åˆ›ä½œç¯‡ç« </text>
          <text class="chapter-count">{{chapters.length}}ç« </text>
        </view>
        
        <view class="chapters-container">
          <view 
            class="chapter-item {{(!item.current_version || item.current_version.ID === 0) ? 'pending' : ''}}" 
            wx:for="{{chapters}}" 
            wx:key="ID"
            bindtap="navigateToChapter"
            data-id="{{item.ID}}"
          >
            <view class="chapter-info">
              <text class="chapter-title">{{item.Title}}</text>
              <text class="chapter-status {{(!item.current_version || item.current_version.ID === 0) ? 'pending' : 'published'}}">
                {{(!item.current_version || item.current_version.ID === 0) ? 'æœªå¼€å§‹' : 'å·²å‘å¸ƒ'}}
              </text>
            </view>
            <text class="chapter-desc">{{item.Description}}</text>
            <view class="chapter-meta">
              <text class="update-time">æ›´æ–°äº {{item.UpdatedAt}}</text>
              <text class="word-count" wx:if="{{item.current_version && item.current_version.ID !== 0}}">
                å­—æ•°ï¼š{{item.current_version.content.length}}
              </text>
            </view>
          </view>
        </view>
        
        <!-- ç©ºçŠ¶æ€ -->
        <view wx:if="{{chapters.length === 0}}" class="empty-state">
          <view class="empty-icon">
            <icon type="info" size="40" color="#3f3f46"/>
          </view>
          <view class="empty-text">æš‚æ— ç« èŠ‚</view>
          <view class="empty-subtext">ä½œè€…æ­£åœ¨åˆ›ä½œä¸­...</view>
        </view>
      </view>

      <!-- è¯„è®ºåŒºåŸŸ -->
      <view class="content-section">
        <view class="section-header">
          <text class="section-title">é¡¹ç›®è¯„è®º</text>
        </view>
        
        <view class="comment-input">
          <textarea 
            placeholder="åˆ†äº«ä½ çš„æƒ³æ³•..." 
            value="{{commentContent}}" 
            bindinput="onCommentInput"
            class="input-area"
            placeholder-class="placeholder-style"
            maxlength="200"
          ></textarea>
          <button class="submit-btn" bindtap="submitComment">å‘è¡¨</button>
        </view>
        
        <view class="comments-list">
          <block wx:if="{{comments.length > 0}}">
            <view class="comment-item" wx:for="{{comments}}" wx:key="ID">
              <image class="commenter-avatar" src="{{ item.user.avatar}}" mode="aspectFill"></image>
              <view class="comment-content">
                <view class="comment-header">
                  <text class="commenter-name">{{item.user.nickname || item.user.username}}</text>
                  <text class="comment-time">{{item.CreatedAt}}</text>
                </view>
                <text class="comment-text">{{item.Content}}</text>
              </view>
            </view>
          </block>
          
          <!-- ç©ºçŠ¶æ€ -->
          <view wx:else class="empty-state">
            <view class="empty-icon">
              <icon type="info" size="40" color="#3f3f46"/>
            </view>
            <view class="empty-text">æš‚æ— è¯„è®º</view>
            <view class="empty-subtext">æ¥è¯´ä¸¤å¥å§~</view>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <view class="action-bar">
      <button class="action-btn favorite-btn {{isFavorited ? 'favorited' : ''}}" bindtap="toggleFavorite">
        <view class="btn-icon">{{isFavorited ? 'â­' : 'â˜†'}}</view>
        <text>{{isFavorited ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
      </button>
      <button class="action-btn share-btn" open-type="share">
        <view class="btn-icon">ğŸ”—</view>
        <text>åˆ†äº«</text>
      </button>
    </view>
  </block>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-container" wx:else>
    <view class="empty-icon">
      <icon type="warn" size="40" color="#3f3f46"/>
    </view>
    <view class="empty-text">é¡¹ç›®ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤</view>
    <view class="empty-subtext">è¯·è¿”å›é¦–é¡µæŸ¥çœ‹å…¶ä»–é¡¹ç›®</view>
  </view>
</view> 