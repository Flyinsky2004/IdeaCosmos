<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <block wx:elif="{{project}}">
    <!-- é¡¹ç›®å¤´éƒ¨ä¿¡æ¯ -->
    <view class="project-header">
      <image class="project-cover" src="{{project.cover_image}}" mode="aspectFill"></image>
      <view class="header-content">
        <view class="project-info">
          <text class="project-title">{{project.project_name}}</text>
          <text class="project-type">{{project.types}}</text>
          
          <!-- æ•°æ®ç»Ÿè®¡ -->
          <view class="stats-container">
            <view class="stat-item">
              <text class="stat-icon">ğŸ‘ï¸</text>
              <text class="stat-value">{{project.watches}} æµè§ˆ</text>
            </view>
            <view class="stat-item" bindtap="toggleFavorite">
              <text class="stat-icon">{{isFavorited ? 'â­' : 'â˜†'}}</text>
              <text class="stat-value">{{project.favorites}} æ”¶è—</text>
            </view>
          </view>
        </view>

        <!-- é¡¹ç›®æè¿° -->
        <view class="description-section">
          <text class="section-title">å‰§æƒ…ç®€ä»‹</text>
          <text class="description-text">{{project.social_story}}</text>
        </view>

        <!-- åˆ›ä½œé£æ ¼æ ‡ç­¾ -->
        <view class="tags-section">
          <text class="section-title">åˆ›ä½œé£æ ¼</text>
          <view class="tags-container">
            <text class="tag-item" wx:for="{{project.style}}" wx:key="*this">{{item}}</text>
          </view>
        </view>

        <!-- é€‚å®œäººç¾¤æ ‡ç­¾ -->
        <view class="tags-section">
          <text class="section-title">é€‚å®œäººç¾¤</text>
          <view class="tags-container">
            <text class="tag-item market-tag" wx:for="{{project.market_people}}" wx:key="*this">{{item}}</text>
          </view>
        </view>

        <!-- åˆ›ä½œå›¢é˜Ÿ -->
        <view class="team-section">
          <text class="section-title">åˆ›ä½œå›¢é˜Ÿ</text>
          <view class="team-info">
            <image class="team-avatar" src="{{project.team.avatar}}" mode="aspectFill"></image>
            <text class="team-name">{{project.team.username}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- è§’è‰²åˆ—è¡¨ -->
    <view class="section-card">
      <text class="section-title">è§’è‰²åˆ—è¡¨</text>
      <view class="characters-grid">
        <view class="character-item" wx:for="{{characters}}" wx:key="ID">
          <image class="character-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
          <text class="character-name">{{item.name}}</text>
          <text class="character-desc">{{item.description}}</text>
        </view>
      </view>
    </view>

    <!-- ç« èŠ‚åˆ—è¡¨ -->
    <view class="section-card">
      <view class="section-header">
        <text class="section-title">åˆ›ä½œç¯‡ç« </text>
        <text class="chapter-count">å…± {{chapters.length}} ç« </text>
      </view>
      <view class="chapters-container">
        <view class="chapter-item {{item.CurrentVersion.ID === 0 ? 'pending' : ''}}" 
              wx:for="{{chapters}}" 
              wx:key="ID"
              bindtap="navigateToChapter"
              data-id="{{item.ID}}">
          <view class="chapter-info">
            <text class="chapter-title">{{item.Title}}</text>
            <text class="chapter-status {{item.CurrentVersion.ID === 0 ? 'pending' : 'published'}}">
              {{item.CurrentVersion.ID === 0 ? 'æœªå¼€å§‹åˆ›ä½œ' : 'å·²å‘å¸ƒ'}}
            </text>
          </view>
          <text class="chapter-desc">{{item.Description}}</text>
          <view class="chapter-meta">
            <text class="update-time">æ›´æ–°äº {{item.UpdatedAt}}</text>
            <text class="word-count" wx:if="{{item.CurrentVersion.ID !== 0}}">
              å­—æ•°ï¼š{{item.CurrentVersion.content.length}}
            </text>
          </view>
        </view>
      </view>
    </view>

    <!-- è¯„è®ºåŒºåŸŸ -->
    <view class="section-card">
      <text class="section-title">é¡¹ç›®è¯„è®º</text>
      <view class="comment-input">
        <textarea 
          placeholder="åˆ†äº«ä½ çš„æƒ³æ³•..." 
          value="{{commentContent}}" 
          bindinput="onCommentInput"
          class="input-area"
          placeholder-class="placeholder-style"
        ></textarea>
        <button class="submit-btn" bindtap="submitComment">å‘è¡¨è¯„è®º</button>
      </view>
      <view class="comments-list">
        <block wx:if="{{comments.length > 0}}">
          <view class="comment-item" wx:for="{{comments}}" wx:key="ID">
            <image class="commenter-avatar" src="{{item.user.avatar}}" mode="aspectFill"></image>
            <view class="comment-content">
              <view class="comment-header">
                <text class="commenter-name">{{item.user.nickname || item.user.username}}</text>
                <text class="comment-time">{{item.CreatedAt}}</text>
              </view>
              <text class="comment-text">{{item.Content}}</text>
            </view>
          </view>
        </block>
        <view wx:else class="empty-comments">
          <text class="empty-text">æš‚æ— è¯„è®ºï¼Œæ¥è¯´ä¸¤å¥å§~</text>
        </view>
      </view>
    </view>
  </block>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-container" wx:else>
    <text class="error-text">é¡¹ç›®ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤</text>
  </view>
</view> 